---
sidebar_label: Webhook
sidebar_position: 27
---

# Webhook

:::tip 前置条件

- 仅企业版和平台版支持此功能，如需要，请[扫码联系微信](/img/wechat.png)
:::

## 功能简介

Webhook是微语系统的重要消息推送功能，用于将系统内的各类重要事件和消息实时推送到外部系统。通过配置Webhook URL，微语系统可以自动将留言消息、客户留资、系统报警等信息推送到企业微信、飞书、钉钉等第三方平台，实现消息的及时通知和处理。

![webhook](/img/develop/admin/webhook.png)

## 主要应用场景

### 📝 留言消息推送

- **客户留言通知**：当客户在非工作时间或客服不在线时提交留言，自动推送到指定渠道
- **留言内容同步**：将留言的详细信息（包括客户信息、留言内容、联系方式等）推送到企业协作平台
- **及时响应提醒**：确保客服人员能够及时看到客户留言，提高响应速度

### 👤 客户留资推送

- **潜在客户信息**：当访客提交联系方式或注册信息时，实时推送到CRM系统
- **销售线索管理**：将客户留资信息自动同步到销售团队的工作平台
- **客户画像构建**：推送客户行为数据，帮助构建完整的客户画像

### ⚠️ 系统报警推送

- **系统异常通知**：当系统出现异常或故障时，及时推送到运维团队
- **性能监控报警**：系统性能指标异常时自动推送报警信息
- **安全事件通知**：检测到安全相关事件时立即通知相关人员

### 🎫 工单状态变更

- **工单创建通知**：新工单创建时推送到相关负责人
- **工单状态更新**：工单状态发生变化时同步通知相关人员
- **工单处理提醒**：工单即将超时或需要升级时发送提醒

## 支持的推送平台

### 企业微信

- **群机器人**：支持企业微信群机器人Webhook
- **应用消息**：通过企业微信应用发送消息
- **部门通知**：支持按部门推送消息

### 飞书

- **群机器人**：支持飞书群机器人Webhook
- **应用消息**：通过飞书应用发送消息
- **多租户支持**：支持多个飞书租户的消息推送

### 钉钉

- **群机器人**：支持钉钉群机器人Webhook
- **工作通知**：通过钉钉工作通知发送消息
- **部门管理**：支持按部门架构推送消息

### 其他平台

- **Slack**：支持Slack Webhook集成
- **Discord**：支持Discord Webhook集成
- **自定义API**：支持推送到自定义的API接口

## 配置说明

### 基本配置

在微语管理后台的Webhook配置页面(管理后台-》设置-》webhook)，您需要配置以下信息：

1. **Webhook名称**：为每个Webhook配置起一个便于识别的名称
2. **推送URL**：目标平台的Webhook接收地址
3. **推送类型**：选择需要推送的事件类型
4. **状态开关**：启用或禁用该Webhook配置

### 推送类型配置

#### 留言消息推送

```json
{
  "type": "leave_message",
  "enabled": true,
  "events": ["new_message", "message_replied"]
}
```

#### 客户留资推送

```json
{
  "type": "customer_info",
  "enabled": true,
  "events": ["new_customer", "info_updated"]
}
```

#### 系统报警推送

```json
{
  "type": "system_alert",
  "enabled": true,
  "events": ["error", "warning", "info"]
}
```

### 消息格式

#### 留言消息格式

```json
{
  "event_type": "leave_message",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "message_id": "msg_123456",
    "customer_name": "张三",
    "customer_phone": "13800138000",
    "customer_email": "zhangsan@example.com",
    "message_content": "我想咨询一下产品价格",
    "channel": "web",
    "created_time": "2024-01-15T10:30:00Z"
  }
}
```

#### 客户留资格式

```json
{
  "event_type": "customer_info",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "customer_id": "cust_123456",
    "name": "李四",
    "phone": "13900139000",
    "email": "lisi@example.com",
    "company": "某某公司",
    "position": "技术经理",
    "source": "官网注册",
    "created_time": "2024-01-15T10:30:00Z"
  }
}
```

#### 系统报警格式

```json
{
  "event_type": "system_alert",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "alert_id": "alert_123456",
    "level": "warning",
    "title": "系统性能警告",
    "message": "服务器CPU使用率超过80%",
    "details": {
      "cpu_usage": "85%",
      "memory_usage": "70%",
      "server_id": "server_001"
    },
    "created_time": "2024-01-15T10:30:00Z"
  }
}
```

## 使用示例

### 企业微信群机器人配置

1. **获取Webhook URL**
   - 在企业微信群中添加机器人
   - 复制机器人的Webhook URL

2. **配置微语Webhook**

   ```js
   Webhook名称：企业微信客服群
   推送URL：https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxxxxx
   推送类型：留言消息、客户留资、系统报警
   状态：启用
   ```

3. **测试推送**
   - 在微语后台点击"测试推送"按钮
   - 检查企业微信群是否收到测试消息

### 飞书群机器人配置

1. **创建飞书机器人**
   - 在飞书群中添加自定义机器人
   - 设置机器人名称和头像
   - 获取Webhook URL

2. **配置推送规则**

   ```js
   Webhook名称：飞书客服通知
   推送URL：https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx
   推送类型：留言消息、工单状态变更
   状态：启用
   ```

### 钉钉群机器人配置

1. **添加钉钉机器人**
   - 在钉钉群中添加自定义机器人
   - 选择安全设置（关键词、IP白名单等）
   - 获取Webhook地址

2. **配置推送设置**

   ```js
   Webhook名称：钉钉运维群
   推送URL：https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxx
   推送类型：系统报警、工单状态变更
   状态：启用
   ```

## 高级配置

### 消息过滤

- **关键词过滤**：只推送包含特定关键词的消息
- **时间过滤**：只在指定时间段内推送消息
- **频率限制**：设置推送频率，避免消息过多

### 消息模板

- **自定义模板**：支持自定义消息格式和内容
- **变量替换**：支持在消息中使用动态变量
- **多语言支持**：支持不同语言的消息模板

### 重试机制

- **自动重试**：推送失败时自动重试
- **重试次数**：可配置重试次数和间隔
- **失败通知**：推送失败时通知管理员

## 常见问题

### Q: Webhook推送失败怎么办？

A: 请检查以下几点：

1. 确认Webhook URL是否正确
2. 检查网络连接是否正常
3. 验证目标平台的访问权限
4. 查看微语系统日志获取详细错误信息

### Q: 如何避免重复推送？

A: 系统内置了去重机制，相同内容的消息在短时间内不会重复推送。您也可以配置推送间隔来控制频率。

### Q: 支持推送图片和文件吗？

A: 目前主要支持文本消息推送。图片和文件可以通过URL链接的方式推送，具体格式请参考各平台的API文档。

### Q: 如何监控Webhook推送状态？

A: 在微语管理后台的Webhook配置页面，可以查看推送历史记录和成功率统计。

## 最佳实践

### 1. 合理配置推送类型

- 根据实际需求选择推送类型，避免信息过载
- 为不同类型的消息配置不同的推送渠道

### 2. 设置合适的推送频率

- 避免过于频繁的推送，影响用户体验
- 对于重要消息可以设置即时推送，一般消息可以设置定时推送

### 3. 做好消息备份

- 重要消息建议同时推送到多个渠道
- 定期检查推送日志，确保消息正常送达

### 4. 定期测试和优化

- 定期测试Webhook配置是否正常
- 根据使用情况优化推送规则和消息格式

## 技术支持

如果您在使用Webhook功能时遇到问题，可以通过以下方式获取帮助：

- **文档中心**：查看详细的配置说明和API文档
- **技术支持**：联系微语技术支持团队
- **社区论坛**：在微语社区中与其他用户交流经验
