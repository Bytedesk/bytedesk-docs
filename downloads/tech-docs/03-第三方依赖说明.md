# Bytedesk 后端第三方依赖说明

本文档详细说明 Bytedesk 后端项目使用的第三方依赖库及其用途。

## 目录

- [核心框架依赖](#核心框架依赖)
- [数据访问依赖](#数据访问依赖)
- [AI 集成依赖](#ai-集成依赖)
- [消息通信依赖](#消息通信依赖)
- [安全认证依赖](#安全认证依赖)
- [工具类库依赖](#工具类库依赖)
- [外部服务依赖](#外部服务依赖)
- [开发测试依赖](#开发测试依赖)
- [版本管理](#版本管理)

---

## 核心框架依赖

### Spring Boot 生态

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-boot-starter-web` | 3.5.8 | Web 应用基础，包含 Spring MVC、Tomcat/Jetty |
| `spring-boot-starter-webflux` | 3.5.8 | 响应式 Web 支持 |
| `spring-boot-starter-jetty` | 3.5.8 | Jetty 服务器（替代默认 Tomcat） |
| `spring-boot-starter-security` | 3.5.8 | 安全框架，认证和授权 |
| `spring-boot-starter-validation` | 3.5.8 | 数据验证（JSR-380） |
| `spring-boot-starter-cache` | 3.5.8 | 缓存抽象 |
| `spring-boot-starter-actuator` | 3.5.8 | 应用监控和管理端点 |
| `spring-boot-starter-aop` | 3.5.8 | 面向切面编程支持 |
| `spring-boot-starter-quartz` | 3.5.8 | 定时任务调度 |
| `spring-boot-starter-batch` | 3.5.8 | 批处理任务 |
| `spring-boot-starter-freemarker` | 3.5.8 | FreeMarker 模板引擎 |
| `spring-boot-devtools` | 3.5.8 | 开发工具（热重载） |

### Spring 生态扩展

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-retry` | - | 重试机制 |
| `spring-integration-mail` | - | 邮件集成，用于轮询邮箱 |
| `spring-boot-starter-mail` | - | 邮件发送支持 |

---

## 数据访问依赖

### JPA 和数据库

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-boot-starter-data-jpa` | 3.5.8 | JPA 数据访问抽象 |
| `spring-boot-starter-data-redis` | 3.5.8 | Redis 数据访问 |
| `spring-boot-starter-data-elasticsearch` | 3.5.8 | Elasticsearch 全文检索 |
| `spring-boot-starter-artemis` | 3.5.8 | JMS 消息队列 |

### Redis 客户端

| 依赖 | 版本 | 用途 |
|------|------|------|
| `jedis` | 6.0.0 | Redis Java 客户端 |
| `commons-pool2` | - | 连接池（用于 Jedis） |

### 数据库支持

项目支持以下数据库（通过 JPA 自动适配）：

- **MySQL**（主要）
- **PostgreSQL**
- **H2**（开发/测试）
- **Oracle**
- **KingBase**（人大金仓）

---

## AI 集成依赖

### Spring AI 框架

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-ai` | 1.1.2 | Spring AI 核心框架 |
| `spring-ai-alibaba` | 1.1.0.0 | 阿里云 AI 集成 |

### AI 提供商 SDK

项目集成了多家 AI 服务提供商：

| 提供商 | 依赖/SDK | 说明 |
|--------|---------|------|
| **ZhipuAI**（智谱 AI） | Spring AI 内置 | GLM 系列模型 |
| **DeepSeek** | Spring AI 内置 | DeepSeek 系列 |
| **Baidu**（百度） | Spring AI 内置 | 文心一言 |
| **Google** | Spring AI 内置 | Gemini 系列 |
| **OpenAI** | Spring AI 内置 | GPT 系列 |
| **Volcengine**（火山引擎） | Spring AI 内置 | 火山方舟 |
| **Tencent**（腾讯） | Spring AI 内置 | 混元系列 |
| **Dashscope**（阿里） | Spring AI 内置 | 通义千问 |
| **MiniMax** | Spring AI 内置 | MiniMax 系列 |
| **Gitee AI** | Spring AI 内置 | Gitee AI 服务 |
| **OpenRouter** | Spring AI 内置 | 多模型路由 |
| **SiliconFlow** | Spring AI 内置 | 硅基流动 |
| **Ollama** | Spring AI 内置 | 本地模型运行 |

### 依赖管理

Spring AI 相关依赖使用 Spring Milestones 仓库：

```xml
<repository>
    <id>spring-milestones</id>
    <name>Spring Milestones</name>
    <url>https://repo.spring.io/milestone</url>
</repository>
```

---

## 消息通信依赖

### 消息队列

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-boot-starter-artemis` | 3.5.8 | JMS 消息队列 |
| `spring-integration-mail` | - | 邮件集成和工作流 |

### WebSocket

| 依赖 | 版本 | 用途 |
|------|------|------|
| Netty（隐式） | - | WebSocket 服务端 |
| `spring-boot-starter-websocket` | - | WebSocket 支持 |

---

## 安全认证依赖

### Spring Security

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-boot-starter-security` | 3.5.8 | 认证和授权框架 |
| `spring-security-test` | - | 安全测试支持 |

### 加密和密钥

| 依赖 | 版本 | 用途 |
|------|------|------|
| Jasypt（可选） | - | 配置文件加密 |

---

## 工具类库依赖

### JSON 处理

| 依赖 | 版本 | 用途 |
|------|------|------|
| `jackson-core` | 2.19.2 | Jackson 核心库 |
| `jackson-databind` | 2.19.2 | JSON 数据绑定 |
| `jackson-annotations` | 2.19.2 | JSON 注解 |
| `jackson-datatype-jsr310` | 2.19.2 | Java 8 日期时间类型支持 |
| `jackson-datatype-hibernate5-jakarta` | 2.19.2 | Hibernate 懒加载支持 |
| `jackson-dataformat-xml` | 2.19.2 | XML 格式支持 |
| `fastjson2` | 2.0.53 | 阿里巴巴 JSON 库 |

### 对象映射

| 依赖 | 版本 | 用途 |
|------|------|------|
| `modelmapper` | 3.2.0 | 对象属性映射 |

### 缓存

| 依赖 | 版本 | 用途 |
|------|------|------|
| `caffeine` | - | 高性能本地缓存 |

### 集合和工具

| 依赖 | 版本 | 用途 |
|------|------|------|
| `guava` | 33.3.1-jre | Google 核心库 |
| `commons-io` | 2.20.0 | IO 工具类 |
| `commons-pool2` | - | 对象池 |

### 验证和处理

| 依赖 | 版本 | 用途 |
|------|------|------|
| `libphonenumber` | 8.13.51 | 手机号验证和解析 |
| `carrier` | 1.235 | 手机号运营商查询 |
| `geocoder` | 2.245 | 手机号归属地查询 |
| `kaptcha` | 2.3.3 | 验证码生成 |

---

## 外部服务依赖

### 阿里云服务

| 依赖 | 版本 | 用途 |
|------|------|------|
| `aliyun-java-sdk-core` | 4.5.13 | 阿里云 SDK 核心 |
| `aliyun-java-sdk-dm` | 3.3.1 | 阿里云邮件发送 |

### Excel 处理

| 依赖 | 版本 | 用途 |
|------|------|------|
| `easyexcel` | 4.0.3 | 阿里 EasyExcel |

---

## API 文档依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| `springdoc-openapi-starter-webmvc-ui` | 2.8.8 | OpenAPI 3.0 文档（WebMVC） |
| `springdoc-openapi-starter-webflux-ui` | 2.8.8 | OpenAPI 3.0 文档（WebFlux） |

**访问地址**:
- Swagger UI: `http://localhost:9003/swagger-ui/index.html`
- OpenAPI JSON: `http://localhost:9003/v3/api-docs`

---

## 开发测试依赖

### 测试框架

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-boot-starter-test` | 3.5.8 | Spring Boot 测试支持 |
| `spring-security-test` | - | 安全测试支持 |

### 开发工具

| 依赖 | 版本 | 用途 |
|------|------|------|
| `spring-boot-configuration-processor` | - | 配置元数据生成 |
| `lombok` | - | 简化 Java 代码 |

---

## 版本管理

### Maven 属性定义

在根 `pom.xml` 中定义的版本：

```xml
<properties>
    <java.version>17</java.version>
    <jackson.version>2.19.2</jackson.version>
    <springdoc.version>2.8.8</springdoc.version>
    <spring-ai.version>1.1.2</spring-ai.version>
    <spring-ai-alibaba.version>1.1.0.0</spring-ai-alibaba.version>
    <jedis.version>6.0.0</jedis.version>
    <revision>1.2.0</revision>
</properties>
```

### 依赖作用域

| 作用域 | 说明 |
|--------|------|
| `compile` | 默认，在所有阶段可用 |
| `provided` | 编译和测试时需要，运行时由容器提供 |
| `runtime` | 运行和测试时需要 |
| `test` | 仅测试时可用 |
| `system` | 本地显式提供 |

### 依赖排除

项目使用 `provided` 作用域避免依赖冲突：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
    <scope>provided</scope>
</dependency>
```

---

## 依赖冲突解决

### 常见问题

1. **Jackson 版本冲突**
   - 解决：统一使用 `${jackson.version}` 管理

2. **Spring AI 依赖下载失败**
   - 解决：配置 Spring Milestones 仓库

3. **slf4j 冲突**
   - 解决：排除重复依赖

### 查看依赖树

```bash
# 查看完整依赖树
mvn dependency:tree

# 查看特定模块依赖
mvn dependency:tree -pl modules/core

# 查看依赖冲突
mvn dependency:tree -Dverbose
```

---

## 添加新依赖指南

### 1. 在父 POM 中定义版本（可选）

```xml
<properties>
    <new-library.version>1.0.0</new-library.version>
</properties>
```

### 2. 在模块 POM 中添加依赖

```xml
<dependency>
    <groupId>com.example</groupId>
    <artifactId>new-library</artifactId>
    <version>${new-library.version}</version>
</dependency>
```

### 3. 更新项目

```bash
mvn clean install
```

---

## 许可证说明

请确保在使用第三方依赖时遵守其对应的许可证：

- **Spring Boot**: Apache License 2.0
- **Jackson**: Apache License 2.0
- **FastJSON2**: Apache License 2.0
- **Guava**: Apache License 2.0
- **Caffeine**: Apache License 2.0
- **Spring AI**: Apache License 2.0

---

## 相关文档

- [安装和运行指南](./01-安装和运行指南.md)
- [代码项目结构说明](./02-代码项目结构说明.md)
- [环境变量配置](./04-环境变量和代码规范配置.md)
- [数据结构文档](./05-数据结构文档.md)
